<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistem Penjanaan Surat Perletakan Jawatan</title>
  <!-- Tailwind CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <!-- Google Fonts: Autograf untuk tandatangan input text -->
  <link href="https://fonts.googleapis.com/css2?family=Autograf&display=swap" rel="stylesheet">
  <!-- html2pdf.js CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js" 
          integrity="sha512-YcsIpTFRc0tHEgYpP+TUPn6yYP0T7Dcv/xD7Hih5oOH0S8Q+F0Mr2ygZ+Kp+S0zMfX7WQbhBsD6K0yZ0JULH7Q==" 
          crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <style>
    /* Gaya untuk kanvas tandatangan */
    #signatureCanvas {
      border: 1px solid #ccc;
      background-color: #fff;
      touch-action: none;
    }
    /* CSS untuk page break pada attachments dalam PDF */
    @media print {
      .page-break {
        page-break-before: always;
      }
    }
  </style>
</head>
<body class="bg-gray-100 p-4">
  <!-- Borang Input -->
  <div class="max-w-6xl mx-auto bg-white p-6 rounded-md shadow-md">
    <h1 class="text-2xl font-bold mb-4">Sistem Penjanaan Surat Perletakan Jawatan</h1>
    <!-- Clear All Button -->
    <button id="clearAllBtn" class="mb-4 bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded">Clear All</button>
    
    <!-- Maklumat Pengirim -->
    <div class="mb-6 border p-4 rounded">
      <div class="flex justify-between items-center mb-2">
        <h2 class="font-bold text-lg">Maklumat Pengirim</h2>
        <button id="clearPengirimBtn" class="bg-red-500 hover:bg-red-600 text-white py-1 px-2 rounded text-sm">Clear Section</button>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block font-semibold">Nama Pekerja*</label>
          <input type="text" id="senderNama" placeholder="Contoh: Aidel Shahzreen Bin Mohd" class="border rounded p-2 w-full">
        </div>
        <div>
          <label class="block font-semibold">Jawatan Pekerja*</label>
          <input type="text" id="senderJawatan" placeholder="Contoh: Jurutera Perisian" class="border rounded p-2 w-full">
        </div>
        <div>
          <label class="block font-semibold">Jabatan Pekerja*</label>
          <input type="text" id="senderJabatan" placeholder="Contoh: Jabatan Teknologi Maklumat" class="border rounded p-2 w-full">
        </div>
        <div>
          <!-- Kosongkan jika tiada -->
          <label class="block font-semibold">Nama Syarikat (Pengirim)*</label>
          <input type="text" id="senderSyarikat" placeholder="Contoh: Syarikat XYZ Sdn. Bhd. (kosongkan jika tiada)" class="border rounded p-2 w-full">
        </div>
        <div>
          <label class="block font-semibold">Alamat Pekerja*</label>
          <input type="text" id="senderAlamat" placeholder="Contoh: No 70, Jalan Sungai Isap Damai" class="border rounded p-2 w-full">
        </div>
        <div>
          <label class="block font-semibold">Poskod Pengirim*</label>
          <input type="text" id="senderPoskod" placeholder="Contoh: 30300" class="border rounded p-2 w-full">
        </div>
        <div>
          <label class="block font-semibold">Bandar Pengirim*</label>
          <input type="text" id="senderBandar" placeholder="Contoh: Kuantan" class="border rounded p-2 w-full">
        </div>
        <div>
          <label class="block font-semibold">Negeri Pengirim*</label>
          <input type="text" id="senderNegeri" placeholder="Contoh: Pahang Darul Makmur" class="border rounded p-2 w-full">
        </div>
      </div>
    </div>
    
    <!-- Maklumat Penerima -->
    <div class="mb-6 border p-4 rounded">
      <div class="flex justify-between items-center mb-2">
        <h2 class="font-bold text-lg">Maklumat Penerima</h2>
        <button id="clearPenerimaBtn" class="bg-red-500 hover:bg-red-600 text-white py-1 px-2 rounded text-sm">Clear Section</button>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Gelaran Penerima -->
        <div>
          <label class="block font-semibold">Gelaran Penerima*</label>
          <select id="receiverGelaran" class="border rounded p-2 w-full">
            <option value="Tiada">Tiada</option>
            <option value="Tuan">Tuan</option>
            <option value="puan">puan</option>
            <option value="tuan/puan">tuan/puan</option>
            <option value="lain-lain">lain-lain (masukkan)</option>
          </select>
          <input type="text" id="receiverGelaranLain" placeholder="Sila masukkan" class="border rounded p-2 w-full mt-2 hidden">
        </div>
        <!-- Nama Penerima -->
        <div>
          <label class="block font-semibold">Nama Penerima*</label>
          <input type="text" id="receiverNama" placeholder="Contoh: Guru Bertugas (kosongkan untuk 'Kepada Yang Berkenaan')" class="border rounded p-2 w-full">
        </div>
        <!-- Jawatan Penerima sebagai dropdown -->
        <div>
          <label class="block font-semibold">Jawatan Penerima*</label>
          <select id="receiverJawatanSelect" class="border rounded p-2 w-full">
            <option value="Tiada">Tiada</option>
            <option value="lain-lain">lain-lain (masukkan)</option>
          </select>
          <input type="text" id="receiverJawatanLain" placeholder="Sila masukkan" class="border rounded p-2 w-full mt-2 hidden">
        </div>
        <div>
          <label class="block font-semibold">Nama Syarikat*</label>
          <input type="text" id="receiverSyarikat" placeholder="Contoh: Syarikat ABC Sdn Bhd" class="border rounded p-2 w-full">
        </div>
        <div>
          <label class="block font-semibold">Alamat Syarikat*</label>
          <input type="text" id="receiverAlamat" placeholder="Contoh: Menara ABC, Jalan Sultan Ismail" class="border rounded p-2 w-full">
        </div>
        <div>
          <label class="block font-semibold">Poskod Penerima*</label>
          <input type="text" id="receiverPoskod" placeholder="Contoh: 50250" class="border rounded p-2 w-full">
        </div>
        <div>
          <label class="block font-semibold">Bandar Penerima*</label>
          <input type="text" id="receiverBandar" placeholder="Contoh: Kuala Lumpur" class="border rounded p-2 w-full">
        </div>
        <div>
          <label class="block font-semibold">Negeri Penerima*</label>
          <input type="text" id="receiverNegeri" placeholder="Contoh: Wilayah Persekutuan" class="border rounded p-2 w-full">
        </div>
      </div>
    </div>
    
    <!-- Maklumat Tarikh -->
    <div class="mb-6 border p-4 rounded">
      <div class="flex justify-between items-center mb-2">
        <h2 class="font-bold text-lg">Maklumat Tarikh</h2>
        <button id="clearTarikhBtn" class="bg-red-500 hover:bg-red-600 text-white py-1 px-2 rounded text-sm">Clear Section</button>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block font-semibold">Tarikh Surat*</label>
          <input type="date" id="tarikhSurat" class="border rounded p-2 w-full">
        </div>
        <div>
          <label class="block font-semibold">Tarikh Akhir Bekerja*</label>
          <input type="date" id="tarikhAkhir" class="border rounded p-2 w-full">
        </div>
      </div>
    </div>
    
    <!-- Kandungan (Content) -->
    <div class="mb-6 border p-4 rounded">
      <div class="flex justify-between items-center mb-2">
        <h2 class="font-bold text-lg">Kandungan</h2>
        <button id="clearKandunganBtn" class="bg-red-500 hover:bg-red-600 text-white py-1 px-2 rounded text-sm">Clear Content</button>
      </div>
      <div id="kandunganFields">
        <div class="mb-2 flex items-start space-x-2">
          <textarea class="border rounded p-2 w-full" placeholder="Kandungan 1" data-index="0"></textarea>
          <button class="deleteKandungan bg-red-500 hover:bg-red-600 text-white py-1 px-2 rounded text-sm hidden">X</button>
        </div>
      </div>
      <button id="addKandunganBtn" class="bg-blue-500 hover:bg-blue-600 text-white py-1 px-2 rounded text-sm">Tambah Kandungan</button>
    </div>
    
    <!-- Attachments (Multiple file upload) -->
    <div class="mb-6 border p-4 rounded">
      <div class="flex justify-between items-center mb-2">
        <h2 class="font-bold text-lg">Attachments</h2>
        <button id="clearAttachmentBtn" class="bg-red-500 hover:bg-red-600 text-white py-1 px-2 rounded text-sm">Clear Attachments</button>
      </div>
      <!-- multiple attribute dibenarkan -->
      <input type="file" id="attachmentsInput" accept=".pdf,.png,.jpg,.jpeg" multiple class="border rounded p-2 w-full">
    </div>
    
    <!-- Digital Signature -->
    <div class="mb-6 border p-4 rounded">
      <div class="flex justify-between items-center mb-2">
        <h2 class="font-bold text-lg">Digital Signature</h2>
        <button id="clearSignatureBtn" class="bg-red-500 hover:bg-red-600 text-white py-1 px-2 rounded text-sm">Clear Signature</button>
      </div>
      <div class="mb-2">
        <label class="inline-flex items-center mr-4">
          <input type="radio" name="signatureOption" value="text" class="form-radio" checked>
          <span class="ml-2">Tandatangan Teks</span>
        </label>
        <label class="inline-flex items-center">
          <input type="radio" name="signatureOption" value="draw" class="form-radio">
          <span class="ml-2">Lukis Tandatangan</span>
        </label>
      </div>
      <!-- Signature Teks dengan font Autograf -->
      <div id="signatureTextContainer" class="mb-2">
        <label class="block font-semibold">Masukkan Tandatangan (Teks):</label>
        <input type="text" id="signatureText" placeholder="cth: Aidel" class="border rounded p-2 w-full" style="font-family: 'Autograf', cursive;">
      </div>
      <!-- Signature Lukis -->
      <div id="signatureDrawContainer" class="mb-2 hidden">
        <label class="block font-semibold mb-1">Lukis Tandatangan:</label>
        <canvas id="signatureCanvas" width="400" height="100"></canvas>
        <button type="button" id="clearCanvasBtn" class="mt-2 bg-red-500 hover:bg-red-600 text-white py-1 px-2 rounded text-sm">Clear Canvas</button>
      </div>
    </div>
    
    <!-- Butang Muat Turun PDF -->
    <div class="mb-6">
      <button id="downloadBtn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded">
        Muat Turun PDF
      </button>
    </div>
  </div>
  
  <!-- Pratonton Surat -->
  <div class="max-w-6xl mx-auto bg-white p-6 rounded-md shadow-md mt-6" id="letterPreview">
    <h2 class="font-bold text-xl mb-4">Pratonton Surat</h2>
    <!-- Bahagian pratonton di sini akan meniru susunan surat -->
    <div id="previewContent">
      <!-- Contoh kandungan surat – sesuaikan dengan keperluan sebenar -->
      <p>[Contoh kandungan surat]</p>
    </div>
    <!-- Attachments akan dipaparkan pada halaman baru dalam PDF -->
    <div id="previewAttachments" class="page-break mt-4">
      <div id="previewAttachmentsContent"></div>
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Fungsi untuk memformat tarikh sebagai "12 Ogos 2025"
      function formatDate(dateStr) {
        if (!dateStr) return '';
        const dateObj = new Date(dateStr);
        return dateObj.toLocaleDateString('ms-MY', { day: 'numeric', month: 'long', year: 'numeric' });
      }
      
      function updatePreview() {
        // Di sini anda boleh menggabungkan keseluruhan kandungan pratonton mengikut input yang dikehendaki.
        // Untuk contoh ini, kita hanya memastikan bahagian attachment dan signature berfungsi.
        
        // Update Attachment Preview
        updateAttachmentsPreview();
        
        // Update Signature Preview
        const selectedSig = document.querySelector('input[name="signatureOption"]:checked').value;
        const signaturePreview = document.getElementById('signaturePreview');
        let sigHTML = "";
        if (selectedSig === 'text') {
          const sigText = document.getElementById('signatureText').value;
          if (sigText.trim()) {
            sigHTML = `<span style="font-family: 'Autograf', cursive; font-size: 32px;">${sigText}</span>`;
          }
        } else if (selectedSig === 'draw') {
          const canvas = document.getElementById('signatureCanvas');
          if (!isCanvasBlank(canvas)) {
            sigHTML = `<img src="${canvas.toDataURL()}" alt="Signature" class="h-16">`;
          }
        }
        if(sigHTML) {
          // Tampilkan "Yang benar," sekali sahaja di bawah tandatangan
          sigHTML += `<br>Yang benar,<br>${document.getElementById('senderNama').value || '[Nama Pekerja]'}`;
        }
        signaturePreview.innerHTML = sigHTML;
      }
      
      // Fungsi untuk update preview attachment untuk setiap file (multiple)
      function updateAttachmentsPreview() {
        const attachmentsInput = document.getElementById('attachmentsInput');
        const previewAttachmentsContent = document.getElementById('previewAttachmentsContent');
        previewAttachmentsContent.innerHTML = '';
        if (attachmentsInput.files.length > 0) {
          Array.from(attachmentsInput.files).forEach(file => {
            const container = document.createElement('div');
            container.className = "mb-4";
            if (file.type.startsWith('image/')) {
              const reader = new FileReader();
              reader.onload = function(e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.className = "max-w-full";
                container.appendChild(img);
              }
              reader.readAsDataURL(file);
            } else {
              const p = document.createElement('p');
              p.textContent = file.name;
              container.appendChild(p);
            }
            previewAttachmentsContent.appendChild(container);
          });
        }
      }
      
      function isCanvasBlank(canvas) {
        const blank = document.createElement('canvas');
        blank.width = canvas.width;
        blank.height = canvas.height;
        return canvas.toDataURL() === blank.toDataURL();
      }
      
      // Event listeners untuk update preview setiap input/textarea/select
      document.querySelectorAll('input, textarea, select').forEach(el => {
        el.addEventListener('input', updatePreview);
        el.addEventListener('change', updatePreview);
      });
      
      // Pengurusan untuk attachment input (multiple)
      document.getElementById('attachmentsInput').addEventListener('change', updateAttachmentsPreview);
      
      // Pengendalian untuk pilihan Signature (tukar antara text dan draw)
      document.querySelectorAll('input[name="signatureOption"]').forEach(radio => {
        radio.addEventListener('change', () => {
          if (radio.value === 'text') {
            document.getElementById('signatureTextContainer').classList.remove('hidden');
            document.getElementById('signatureDrawContainer').classList.add('hidden');
          } else {
            document.getElementById('signatureDrawContainer').classList.remove('hidden');
            document.getElementById('signatureTextContainer').classList.add('hidden');
          }
          updatePreview();
        });
      });
      
      // Pengendalian lukisan pada kanvas signature
      const canvas = document.getElementById('signatureCanvas');
      const ctx = canvas.getContext('2d');
      ctx.lineWidth = 2;
      ctx.lineCap = 'round';
      let drawing = false;
      function startDrawing(e) {
        drawing = true;
        draw(e);
      }
      function endDrawing() {
        drawing = false;
        ctx.beginPath();
        updatePreview();
      }
      function draw(e) {
        if (!drawing) return;
        e.preventDefault();
        const rect = canvas.getBoundingClientRect();
        const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
        const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(x, y);
      }
      canvas.addEventListener('mousedown', startDrawing);
      canvas.addEventListener('mouseup', endDrawing);
      canvas.addEventListener('mousemove', draw);
      canvas.addEventListener('touchstart', startDrawing);
      canvas.addEventListener('touchend', endDrawing);
      canvas.addEventListener('touchmove', draw);
      
      // Butang Clear untuk Canvas
      document.getElementById('clearCanvasBtn').addEventListener('click', () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        updatePreview();
      });
      
      // Butang Clear Section untuk setiap bahagian
      document.getElementById('clearPengirimBtn').addEventListener('click', () => {
        document.getElementById('senderNama').value = '';
        document.getElementById('senderJawatan').value = '';
        document.getElementById('senderJabatan').value = '';
        document.getElementById('senderSyarikat').value = '';
        document.getElementById('senderAlamat').value = '';
        document.getElementById('senderPoskod').value = '';
        document.getElementById('senderBandar').value = '';
        document.getElementById('senderNegeri').value = '';
        updatePreview();
      });
      document.getElementById('clearPenerimaBtn').addEventListener('click', () => {
        document.getElementById('receiverGelaran').value = 'Tiada';
        document.getElementById('receiverNama').value = '';
        document.getElementById('receiverJawatanSelect').value = 'Tiada';
        document.getElementById('receiverJawatanLain').value = '';
        document.getElementById('receiverJawatanLain').classList.add('hidden');
        document.getElementById('receiverSyarikat').value = '';
        document.getElementById('receiverAlamat').value = '';
        document.getElementById('receiverPoskod').value = '';
        document.getElementById('receiverBandar').value = '';
        document.getElementById('receiverNegeri').value = '';
        document.getElementById('receiverGelaranLain').value = '';
        document.getElementById('receiverGelaranLain').classList.add('hidden');
        updatePreview();
      });
      document.getElementById('clearTarikhBtn').addEventListener('click', () => {
        document.getElementById('tarikhSurat').value = '';
        document.getElementById('tarikhAkhir').value = '';
        updatePreview();
      });
      document.getElementById('clearKandunganBtn').addEventListener('click', () => {
        document.getElementById('kandunganFields').innerHTML = `<div class="mb-2 flex items-start space-x-2">
            <textarea class="border rounded p-2 w-full" placeholder="Kandungan 1" data-index="0"></textarea>
            <button class="deleteKandungan bg-red-500 hover:bg-red-600 text-white py-1 px-2 rounded text-sm hidden">X</button>
          </div>`;
        toggleDeleteButtons();
        updatePreview();
      });
      document.getElementById('clearAttachmentBtn').addEventListener('click', () => {
        document.getElementById('attachmentsInput').value = '';
        updateAttachmentsPreview();
      });
      document.getElementById('clearSignatureBtn').addEventListener('click', () => {
        document.getElementById('signatureText').value = '';
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        updatePreview();
      });
      document.getElementById('clearAllBtn').addEventListener('click', () => {
        document.querySelectorAll('input, textarea, select').forEach(el => {
          if (el.type === 'radio' || el.type === 'checkbox') return;
          el.value = '';
        });
        document.getElementById('kandunganFields').innerHTML = `<div class="mb-2 flex items-start space-x-2">
            <textarea class="border rounded p-2 w-full" placeholder="Kandungan 1" data-index="0"></textarea>
            <button class="deleteKandungan bg-red-500 hover:bg-red-600 text-white py-1 px-2 rounded text-sm hidden">X</button>
          </div>`;
        toggleDeleteButtons();
        document.querySelector('input[name="signatureOption"][value="text"]').checked = true;
        document.getElementById('signatureTextContainer').classList.remove('hidden');
        document.getElementById('signatureDrawContainer').classList.add('hidden');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        updatePreview();
      });
      
      function toggleDeleteButtons() {
        const allDeleteBtns = document.querySelectorAll('.deleteKandungan');
        allDeleteBtns.forEach(btn => {
          if (document.querySelectorAll('#kandunganFields textarea').length > 1) {
            btn.classList.remove('hidden');
          } else {
            btn.classList.add('hidden');
          }
        });
      }
      
      // Butang Muat Turun PDF – Generate PDF A4 berdasarkan pratonton
      document.getElementById('downloadBtn').addEventListener('click', () => {
        const letterElement = document.getElementById('letterPreview');
        if (!letterElement) {
          console.error("Elemen pratonton tidak ditemui.");
          return;
        }
        const opt = {
          margin: 0.5,
          filename: 'Surat-Perletakan-Jawatan.pdf',
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2 },
          jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
        };
        html2pdf().from(letterElement).set(opt).save()
          .then(() => { console.log("PDF berjaya dijana."); })
          .catch(err => { console.error("Ralat ketika menjana PDF:", err); });
      });
      
      updatePreview();
    });
  </script>
</body>
</html>
