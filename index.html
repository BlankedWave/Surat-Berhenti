<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- Tailwind CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <!-- Google Font untuk tandatangan teks -->
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">

  <title>Sistem Penjanaan Surat & Tandatangan</title>

  <!-- html2pdf.js (untuk generate PDF) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"
          integrity="sha512-YcsIpTFRc0tHEgYpP+TUPn6yYP0T7Dcv/xD7Hih5oOH0S8Q+F0Mr2ygZ+Kp+S0zMfX7WQbhBsD6K0yZ0JULH7Q=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer"></script>
  <style>
    /* Sedikit gaya untuk kanvas tandatangan */
    #signatureCanvas {
      border: 1px solid #ccc;
      background-color: #fff;
      touch-action: none;
    }
  </style>
</head>
<body class="bg-gray-100 p-4">
  <div class="max-w-5xl mx-auto bg-white p-6 rounded-md shadow-md">
    <h1 class="text-2xl font-bold mb-4">Sistem Penjanaan Surat</h1>

    <!-- Pilihan Bahasa -->
    <div class="mb-4">
      <label class="block font-semibold mb-2">Pilih Bahasa / Choose Language:</label>
      <select id="languageSelect" class="border rounded p-2 w-full">
        <option value="my">Bahasa Melayu</option>
        <option value="en">English</option>
      </select>
    </div>

    <!-- Borang Input Maklumat -->
    <form id="letterForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- Kiri (Maklumat Pekerja) -->
      <div>
        <h2 class="font-bold mb-2">Maklumat Pekerja</h2>
        <label class="block font-semibold">Nama Pekerja</label>
        <input type="text" id="namaPekerja" class="border rounded p-2 w-full mb-2" placeholder="Ali bin Abu" required />

        <label class="block font-semibold">Jawatan Pekerja</label>
        <input type="text" id="jawatanPekerja" class="border rounded p-2 w-full mb-2" placeholder="Eksekutif IT" required />

        <label class="block font-semibold">Jabatan/Department</label>
        <input type="text" id="jabatanPekerja" class="border rounded p-2 w-full mb-2" placeholder="Jabatan IT" required />

        <label class="block font-semibold">Nama Syarikat (Pekerja)</label>
        <input type="text" id="namaSyarikatPekerja" class="border rounded p-2 w-full mb-2" placeholder="Syarikat Maju Sdn. Bhd." required />

        <label class="block font-semibold">Alamat (Pekerja)</label>
        <input type="text" id="alamatPekerja" class="border rounded p-2 w-full mb-2" placeholder="No. 123, Jalan ABC" required />

        <label class="block font-semibold">Bandar (Pekerja)</label>
        <input type="text" id="bandarPekerja" class="border rounded p-2 w-full mb-2" placeholder="Kuala Lumpur" required />

        <label class="block font-semibold">Negeri (Pekerja)</label>
        <input type="text" id="negeriPekerja" class="border rounded p-2 w-full mb-2" placeholder="Wilayah Persekutuan" required />
      </div>

      <!-- Kanan (Maklumat Penerima) -->
      <div>
        <h2 class="font-bold mb-2">Maklumat Penerima</h2>
        <label class="block font-semibold">Nama Penerima</label>
        <input type="text" id="namaPenerima" class="border rounded p-2 w-full mb-2" placeholder="Encik Ahmad bin Ali" required />

        <label class="block font-semibold">Jawatan Penerima</label>
        <input type="text" id="jawatanPenerima" class="border rounded p-2 w-full mb-2" placeholder="Pengurus Sumber Manusia" required />

        <label class="block font-semibold">Nama Syarikat (Penerima)</label>
        <input type="text" id="namaSyarikatPenerima" class="border rounded p-2 w-full mb-2" placeholder="Syarikat Maju Sdn. Bhd." required />

        <label class="block font-semibold">Alamat (Penerima)</label>
        <input type="text" id="alamatPenerima" class="border rounded p-2 w-full mb-2" placeholder="No. 456, Jalan XYZ" required />

        <label class="block font-semibold">Bandar (Penerima)</label>
        <input type="text" id="bandarPenerima" class="border rounded p-2 w-full mb-2" placeholder="Shah Alam" required />

        <label class="block font-semibold">Negeri (Penerima)</label>
        <input type="text" id="negeriPenerima" class="border rounded p-2 w-full mb-2" placeholder="Selangor" required />

        <label class="block font-semibold">Tarikh Surat</label>
        <input type="date" id="tarikh" class="border rounded p-2 w-full mb-2" required />
      </div>

      <!-- Bahagian Tandatangan -->
      <div class="md:col-span-2">
        <h2 class="font-bold mb-2">Tandatangan</h2>
        <div class="mb-2">
          <label class="inline-flex items-center mr-4">
            <input type="radio" name="signatureOption" value="text" class="form-radio" checked>
            <span class="ml-2">Tandatangan Teks</span>
          </label>
          <label class="inline-flex items-center">
            <input type="radio" name="signatureOption" value="draw" class="form-radio">
            <span class="ml-2">Lukis Tandatangan</span>
          </label>
        </div>
        <!-- Input Tandatangan Teks -->
        <div id="textSignatureContainer" class="mb-4">
          <label class="block font-semibold">Masukkan Tandatangan (Teks):</label>
          <input type="text" id="signatureText" class="border rounded p-2 w-full" placeholder="cth: Ali" />
        </div>
        <!-- Kanvas untuk Lukis Tandatangan -->
        <div id="drawSignatureContainer" class="mb-4 hidden">
          <label class="block font-semibold mb-1">Lukis Tandatangan:</label>
          <canvas id="signatureCanvas" width="400" height="100"></canvas>
          <button type="button" id="clearCanvas" class="mt-2 bg-red-500 hover:bg-red-600 text-white py-1 px-2 rounded">Clear</button>
        </div>
      </div>
    </form>

    <!-- Butang Muat Turun PDF -->
    <div class="mt-4">
      <button id="downloadBtn"
              class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded">
        Muat Turun PDF
      </button>
    </div>
  </div>

  <!-- Paparan Surat (sentiasa dipaparkan) -->
  <div class="max-w-5xl mx-auto bg-white p-6 rounded-md shadow-md mt-6">
    <div id="letterContent" class="text-sm leading-relaxed text-gray-900">
      <!-- Kandungan surat akan diisi secara dinamik -->
    </div>
  </div>

  <script>
    // Template surat (gunakan placeholder [TandatanganHTML])
    const suratMY = `
      <p class="mb-4">
        <span class="block font-bold">[Nama Pekerja]</span>
        [Jawatan Pekerja]<br/>
        [Nama Syarikat (Pekerja)]<br/>
        [Alamat Pekerja], [Bandar Pekerja], [Negeri Pekerja]
      </p>

      <p class="mb-4">
        <span class="block font-bold">[Nama Penerima]</span>
        [Jawatan Penerima]<br/>
        [Nama Syarikat (Penerima)]<br/>
        [Alamat Penerima], [Bandar Penerima], [Negeri Penerima]
      </p>

      <p class="text-right">[Tarikh]</p>

      <h2 class="font-bold text-lg my-4">NOTIS PERLETAKAN JAWATAN</h2>

      <p>
        Merujuk kepada perkara di atas, saya <strong>[Nama Pekerja]</strong>, 
        <strong>[Jawatan Pekerja]</strong> dari <strong>[Jabatan Pekerja]</strong> dengan hormatnya ingin memaklumkan 
        perletakan jawatan saya dari <strong>[Nama Syarikat (Pekerja)]</strong>. Tarikh akhir perkhidmatan saya adalah pada <strong>[Tarikh]</strong>.
      </p>

      <p class="mt-2">
        2. Saya ingin memaklumkan bahawa saya telah membuat keputusan untuk meletak jawatan tersebut.
      </p>

      <p class="mt-2">
        3. Saya juga ingin merakamkan penghargaan atas segala kerjasama dan tunjuk ajar yang telah diberikan sepanjang saya berkhidmat di syarikat ini.
      </p>

      <p class="mt-4">
        Sekian, terima kasih.
      </p>

      <p class="mt-4">
        Yang benar,<br/><br/>
        [TandatanganHTML]<br/>
        <strong>[Nama Pekerja]</strong>
      </p>
    `;

    const suratEN = `
      <p class="mb-4">
        <span class="block font-bold">[Employee Name]</span>
        [Employee Position]<br/>
        [Employee Company]<br/>
        [Employee Address], [Employee City], [Employee State]
      </p>

      <p class="mb-4">
        <span class="block font-bold">[Recipient Name]</span>
        [Recipient Position]<br/>
        [Recipient Company]<br/>
        [Recipient Address], [Recipient City], [Recipient State]
      </p>

      <p class="text-right">[Date]</p>

      <h2 class="font-bold text-lg my-4">NOTICE OF RESIGNATION</h2>

      <p>
        With reference to the above matter, I, <strong>[Employee Name]</strong>, 
        <strong>[Employee Position]</strong> from <strong>[Employee Department]</strong>, would like to formally 
        announce my resignation from <strong>[Employee Company]</strong>. My last day of service will be on <strong>[Date]</strong>.
      </p>

      <p class="mt-2">
        2. I would like to inform you that I have decided to resign from the aforementioned position.
      </p>

      <p class="mt-2">
        3. I would also like to express my appreciation for all the cooperation and guidance provided throughout my tenure at this company.
      </p>

      <p class="mt-4">
        Thank you.
      </p>

      <p class="mt-4">
        Yours sincerely,<br/><br/>
        [TandatanganHTML]<br/>
        <strong>[Employee Name]</strong>
      </p>
    `;

    // Elemen borang
    const languageSelect       = document.getElementById('languageSelect');
    const namaPekerja          = document.getElementById('namaPekerja');
    const jawatanPekerja       = document.getElementById('jawatanPekerja');
    const jabatanPekerja       = document.getElementById('jabatanPekerja');
    const namaSyarikatPekerja  = document.getElementById('namaSyarikatPekerja');
    const alamatPekerja        = document.getElementById('alamatPekerja');
    const bandarPekerja        = document.getElementById('bandarPekerja');
    const negeriPekerja        = document.getElementById('negeriPekerja');

    const namaPenerima         = document.getElementById('namaPenerima');
    const jawatanPenerima      = document.getElementById('jawatanPenerima');
    const namaSyarikatPenerima = document.getElementById('namaSyarikatPenerima');
    const alamatPenerima       = document.getElementById('alamatPenerima');
    const bandarPenerima       = document.getElementById('bandarPenerima');
    const negeriPenerima       = document.getElementById('negeriPenerima');
    const tarikhInput          = document.getElementById('tarikh');

    // Elemen untuk tandatangan teks dan lukisan
    const signatureTextInput   = document.getElementById('signatureText');
    const textSignatureContainer = document.getElementById('textSignatureContainer');
    const drawSignatureContainer = document.getElementById('drawSignatureContainer');
    const signatureCanvas      = document.getElementById('signatureCanvas');
    const clearCanvasBtn       = document.getElementById('clearCanvas');

    const letterContent        = document.getElementById('letterContent');
    const downloadBtn          = document.getElementById('downloadBtn');

    // Pengurusan pilihan signature (radio)
    const signatureOptions = document.getElementsByName('signatureOption');
    signatureOptions.forEach(option => {
      option.addEventListener('change', () => {
        // Tunjukkan/ sembunyikan input berdasarkan pilihan
        if (option.value === 'text' && option.checked) {
          textSignatureContainer.classList.remove('hidden');
          drawSignatureContainer.classList.add('hidden');
        } else if (option.value === 'draw' && option.checked) {
          drawSignatureContainer.classList.remove('hidden');
          textSignatureContainer.classList.add('hidden');
        }
        updateLetter();
      });
    });

    // Fungsi update surat (real-time)
    function updateLetter() {
      const language = languageSelect.value;
      let templateSurat = (language === 'my') ? suratMY : suratEN;

      // Format tarikh
      const tarikhValue = tarikhInput.value;
      let formattedDate = '';
      if (tarikhValue) {
        const dateObj = new Date(tarikhValue);
        const optionsMY = { day: 'numeric', month: 'long', year: 'numeric' };
        const optionsEN = { day: 'numeric', month: 'long', year: 'numeric' };
        formattedDate = language === 'my' ? dateObj.toLocaleDateString('ms-MY', optionsMY) 
                                         : dateObj.toLocaleDateString('en-GB', optionsEN);
      }

      // Gantikan placeholder dalam template
      templateSurat = templateSurat
        .replace('[Nama Pekerja]', namaPekerja.value || '')
        .replace('[Jawatan Pekerja]', jawatanPekerja.value || '')
        .replace('[Jabatan Pekerja]', jabatanPekerja.value || '')
        .replace('[Nama Syarikat (Pekerja)]', namaSyarikatPekerja.value || '')
        .replace('[Alamat Pekerja]', alamatPekerja.value || '')
        .replace('[Bandar Pekerja]', bandarPekerja.value || '')
        .replace('[Negeri Pekerja]', negeriPekerja.value || '')
        .replace('[Nama Penerima]', namaPenerima.value || '')
        .replace('[Jawatan Penerima]', jawatanPenerima.value || '')
        .replace('[Nama Syarikat (Penerima)]', namaSyarikatPenerima.value || '')
        .replace('[Alamat Penerima]', alamatPenerima.value || '')
        .replace('[Bandar Penerima]', bandarPenerima.value || '')
        .replace('[Negeri Penerima]', negeriPenerima.value || '')
        .replace('[Tarikh]', formattedDate);

      // Untuk versi English
      templateSurat = templateSurat
        .replace('[Employee Name]', namaPekerja.value || '')
        .replace('[Employee Position]', jawatanPekerja.value || '')
        .replace('[Employee Department]', jabatanPekerja.value || '')
        .replace('[Employee Company]', namaSyarikatPekerja.value || '')
        .replace('[Employee Address]', alamatPekerja.value || '')
        .replace('[Employee City]', bandarPekerja.value || '')
        .replace('[Employee State]', negeriPekerja.value || '')
        .replace('[Recipient Name]', namaPenerima.value || '')
        .replace('[Recipient Position]', jawatanPenerima.value || '')
        .replace('[Recipient Company]', namaSyarikatPenerima.value || '')
        .replace('[Recipient Address]', alamatPenerima.value || '')
        .replace('[Recipient City]', bandarPenerima.value || '')
        .replace('[Recipient State]', negeriPenerima.value || '')
        .replace('[Date]', formattedDate);

      // Tentukan signatureHTML berdasarkan pilihan
      let signatureHTML = '';
      const selectedOption = document.querySelector('input[name="signatureOption"]:checked').value;
      if (selectedOption === 'text') {
        // Tandatangan Teks dengan gaya huruf bergaya
        const sigText = signatureTextInput.value || '';
        signatureHTML = `<span style="font-family: 'Great Vibes', cursive; font-size: 32px;">${sigText}</span>`;
      } else if (selectedOption === 'draw') {
        // Dapatkan data URL dari kanvas
        const dataURL = signatureCanvas.toDataURL();
        // Jika kanvas kosong, paparkan tiada tandatangan
        if (isCanvasBlank(signatureCanvas)) {
          signatureHTML = '';
        } else {
          signatureHTML = `<img src="${dataURL}" alt="Signature" class="h-16" />`;
        }
      }

      // Gantikan placeholder untuk tandatangan
      templateSurat = templateSurat.replace('[TandatanganHTML]', signatureHTML);

      letterContent.innerHTML = templateSurat;
    }

    // Semak jika kanvas kosong
    function isCanvasBlank(canvas) {
      const blank = document.createElement('canvas');
      blank.width = canvas.width;
      blank.height = canvas.height;
      return canvas.toDataURL() === blank.toDataURL();
    }

    // Event listeners untuk input
    const inputs = document.querySelectorAll('#letterForm input, #letterForm select');
    inputs.forEach(input => {
      input.addEventListener('input', updateLetter);
    });

    // Pengendalian lukisan pada kanvas tandatangan
    let drawing = false;
    const ctx = signatureCanvas.getContext('2d');
    ctx.lineWidth = 2;
    ctx.lineCap = 'round';

    function startPosition(e) {
      drawing = true;
      draw(e);
    }
    function endPosition() {
      drawing = false;
      ctx.beginPath();
      updateLetter();
    }
    function draw(e) {
      if (!drawing) return;
      e.preventDefault();
      const rect = signatureCanvas.getBoundingClientRect();
      let x, y;
      if(e.touches) {
        x = e.touches[0].clientX - rect.left;
        y = e.touches[0].clientY - rect.top;
      } else {
        x = e.clientX - rect.left;
        y = e.clientY - rect.top;
      }
      ctx.lineTo(x, y);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(x, y);
    }

    // Event listeners untuk kanvas
    signatureCanvas.addEventListener('mousedown', startPosition);
    signatureCanvas.addEventListener('mouseup', endPosition);
    signatureCanvas.addEventListener('mousemove', draw);
    signatureCanvas.addEventListener('touchstart', startPosition);
    signatureCanvas.addEventListener('touchend', endPosition);
    signatureCanvas.addEventListener('touchmove', draw);

    // Butang clear untuk kanvas
    clearCanvasBtn.addEventListener('click', () => {
      ctx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
      updateLetter();
    });

    // Butang Muat Turun PDF
    downloadBtn.addEventListener('click', function() {
      const opt = {
        margin:       0.5,
        filename:     'Surat-Perletakan-Jawatan.pdf',
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
      };
      html2pdf().from(letterContent).set(opt).save();
    });

    // Panggil sekali untuk paparan awal
    updateLetter();
  </script>
</body>
</html>
